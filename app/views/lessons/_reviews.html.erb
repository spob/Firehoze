<% lesson = object %>

<div id="reviews_count">
  <%= pluralize(lesson.reviews_count, 'Review') %>
</div>

<% if !lesson.reviewed_by?(current_user) and lesson.owned_by?(current_user) %>
  <%= render :partial => "shared/infield_head_content" %>
  <%= javascript 'jquery.simplyCountable', 'validate/reviews' %>

  <div style="margin:10px 0; text-align:right">
    <%= button_to "Write a Review", new_lesson_review_path(lesson), :method => :get, :id => "review_link"  unless lesson.reviewed_by? current_user %>
  </div>

  <div id="review_form" style="display:none">
    <% form_for(:review, :url => lesson_reviews_url(lesson), :html => { :class => "create_review", :id => "inline" }) do |f| %>

      <%= f.error_messages %>

      <fieldset>
        <legend></legend>
        <strong><%= t('review.add_your_review') %></strong>
        <p>
          <%= f.label :headline %><br />
          <%= f.text_field :headline, :maxlength => "100", :style => "width:100%;" %>
        <div class="counter"><span id="headline_counter"></span> characters left</div>
        </p>
        <p>
          <%= f.label :body %><br />
          <%= f.text_area :body, :style => "width:100%;" %>
          <span class="help">(Format using *<b>bold</b>* and _<i>italics</i>_ text)</span>
        </p>
      </fieldset>

      <p>
        <%= f.submit "Create review" %>
        <%= link_to "Cancel", lesson_reviews_path(lesson) %>
      </p>

    <% end %>
  <% end %>
</div>

<% if lesson.reviews.empty?  %>
  <h4>Share your thoughts on this lesson</h4>
<% else %>
  <div id="reviews">
    <%= render :partial => "reviews/review", :collection => lesson.reviews %>
  </div>

<% end %>





